{% extends 'layout/basic.html' %}

{% load bootstrap4 %}
{% load static %}
{% load countries %}

{% block title %}Профиль пользователя{% endblock %}

{% block page_title %}{{ user.username }}{% endblock %}

{% block content %}
<div class="col-md-4">
	<div class="card card-profile">
		<div class="card-avatar" style="max-width: 200px; max-height: 250px">
			<a href="#pablo">
				{% if user.account_image %}
				<img class="img" src="{{ user.account_image.url }}" />
				{% elif user.account_image_url %}
				<img class="img" src="{{ user.account_image_url }}" />
				{% else %}
				<img class="img" src="https://yt3.ggpht.com/WVRcZ5FLdU77PVwnKGRElsqYzsQQimvL8ChTiGkHYiiL3fjrezDtFCTEoHThK2M8GazV_ofA5DmBxTs3-g=s900-mo-c-c0xffffffff-rj-k-no" />
				{% endif %}
			</a>
		</div>
		<div class="card-body">
			<h6 class="card-category">{{ user.activity }}</h6>
			<h4 class="card-title">{{ user.first_name }} {{ user.last_name }}</h4>
			<p class="card-description">
				<div class="table-responsive">
					<table class="table table-hover">
						<tbody>
							<tr>
								{% if request.user.is_authenticated and request.user.username == user.username %}
								<td><input type="text" name="status" id="id_status" value="{{ user.status }}" placeholder="Введите статус" class="form-control"></td>
								<td><button id="submitStatus" type="button" class="btn btn-sm btn-primary" style="display: none">OK</button></td>
								{% else %}
								<td>{{ user.status }}</td>
								{% endif %}
							</tr>
						</tbody>
					</table>
				</div>
			</p>
			{% if request.user.is_authenticated %}
				{% if not user.username == request.user.username %}
					{% if user not in request.user.user_subscriptions.all %}
					<a href="{% url 'articles:subscribe_user' username=user.username %}" class="btn btn-primary btn-round">Follow</a>
					{% else %}
					<a href="{% url 'articles:unsubscribe_user' username=user.username %}" class="btn btn-primary btn-round">Unfollow</a>
					{% endif %}
				{% endif %}
			{% endif %}
		</div>
	</div>
	<div class="card">
		<div class="card-header card-header-info">
			<h4 class="card-title">Подписки <!-- <i class="material-icons">grade</i> --></h4>
		</div>
		<div class="card-body">
			<p>Здесь будут отображаться пользователи, теги и категории на которые вы подписаны</p>
		</div>
	</div>
</div>
<div class="col-md-8">
	<div class="card">
		<div class="card-header card-header-success">
			<h4 class="card-title">Профиль</h4>

			<p class="card-category">Информация</p>
		</div>
		<div class="card-body">
			<div class="row">
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Имя пользователя
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.username }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Компания
									</th>
								</tr>
							</thead>
							<tbody>
								<tr onclick="window.location='#'" onmouseover="" style="cursor: pointer">
									<td>
										{{ user.company }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Деятельность
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.activity }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Имя
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.first_name }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Фамилия
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.last_name }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Страна
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.country.name }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="col">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>
										Город
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										{{ user.city }}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
							<tr>
								<th>
									О себе
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									{{ user.bio }}
								</td>
							</tr>
						</tbody>
					</table>
				</div>
		</div>
				{% if user == request.user %}
					<a href="{% url 'articles:profile_change' username=user.username %}" class="btn btn-primary pull-right">Редактировать профиль</a>
				{% endif %}
				<div class="clearfix"></div>
		</div>
	</div>
</div>

<script type="text/javascript">
	// Show and hide submitStatus button.
	$(document).ready(function() {
		$('#id_status').on('focus', function() {
			$('#submitStatus').slideDown('fast');
		});
		var status = '';
		$('#submitStatus').on('click', function() {
			$('#submitStatus').slideUp('fast');
			status = $('#id_status').val();
			alert(status);
			$.post('{{ request.META.HTTP_HOST }}{% url "articles:update_status" %}', status).done(function(data) {
				$('.content div.text-center').append('<div class="alert alert-success alert-dismissable fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="close">×</button>Вы успешно вышли с сайта!</div>')
			});
		});
		$("#id_status").on('blur', function() {
			$('#submitStatus').slideUp('fast');
		});
	});

	// Click on image
	$("#profilePicture").click(function() {
		$("#id_account_image").click();
	});
	$('#uploadLink').click(function() {
		$('#id_account_image').click();
	});
	// Check if user changed something.
	function submitIfFormComplete() {
		if ($('#id_account_image').prop('files')){
			$('#pictureForm').submit();
		}
	}
</script>
{% endblock %}